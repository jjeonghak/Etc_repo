## InnoDB
InnoDB는 MySQL에서 가장 많이 사용되는 스토리지 엔진  
ACID 특성을 보장하며 트랜잭션, 외래키 제약 충돌 복구 등의 기능 제공  

<br>

![image](https://github.com/user-attachments/assets/c82fb37f-f72d-4329-9ed5-75b7f1409b13)

<br>

## Tablespace
InnoDB는 데이터를 테이블스페이스라는 단위로 저장  
기본적으로 모든 데이터와 인덱스는 단일 테이블스페이스인 시스템 테이블스페이스에 저장  
`innodb-file-per-table` 설정을 통해 각 자체 테이블스페이스에 저장되도록 설정 가능  
기본적으로 리두 로그를 통해서 생성되지만, `O_DIRECT`를 통해서 리두 버퍼와 OS를 거치지 않고 바로 쓰기 가능  

<br>

## Buffer Pool
메모리 내에서 데이터를 캐싱하기 위해 버퍼풀 사용  
디스크 I/O 작업을 줄이고 성능을 향상  

<br>

## Redo Log
로그를 통한 트랜잭션 복구 기능을 제공하는 중요한 구조  
리두 로그는 `log rotation` 형태로 재사용  
안전하게 저장된 이후 로그가 순환되면서 덮어쓰기  

<br>

## Undo Log
트랜잭션이 롤백되었을때 변경 사항 복구를 위한 로그  

<br>

|  | **REDO** | **UNDO** |
|--|--|--|
| 목적 | 시스템 장애시 커밋된 변경 사항 복구 | 트랜잭션 롤백시 변경 사항을 원상태로 복구 |
| 내용 | 커밋된 트랜잭션 변경 사항 | 트랜잭션 시작 전 데이터 상태 |
| 사용 시점 | 시스템 비정상 종료된 후 복구 | 롤백 시점이나 MVCC 지원 |
| 작동 방식 | 변경 사항을 디스크에 다시 적용하여 데이터 일관성 유지 | 변경 이전 상태로 데이터 복원 |

<br>

## B+ 트리 인덱스
데이터를 클러스터 인덱스를 통해서 저장  
기본적으로 B+ 트리 구조를 사용  

<br>

## CREATE DATABASE
1. 디렉토리 생성  
디스크에 새로운 디렉토리 생성  
해당 디렉토리에 데이터베이스 테이블, 인덱스, 스키마 정보 등 저장  

2. 메타 데이터 저장  
새로 생성된 데이터베이스에 대한 메타데이터(이름, 권한 등)는 메타데이터 테이블에 기록  

3. 시스템 테이블 업데이트  
`information_schema`에서 해당 데이터베이스 정보 업데이트  

<br>

## CREATE TABLE
1. 테이블 정의 분석  
DDL 명령어를 파싱하여 테이블 스키마 분석  

2. 테이블 스키마 파일 생성
테이블 메타데이터가 담긴 `.frm` 파일 생성
테이블 칼럼 정의, 인덱스, 제약 조건 등 포함  

3. 테이블 스페이스에 할당
시스템 테이블스페이스에 테이블 데이터 기록  
`innodb-file-per-table` 설정을 통해 각 테이블마다 별도의 파일(`.ibd`) 생성

4. 인덱스 생성
데이블 생성시 기본적으로 클러스터 인덱스가 생성
기본키가 없으면 생성된 row 기준으로 정렬해서 보이지 않는 인덱스 생성(인덱스 조회시 표시 안되지만 내부적으로 존재)  

<br>

## TRANSACTION
1. 트랜잭션 시작  
트랜잭션 시작시 언두 로그 생성  
이 로그를 통해서 변경된 데이터 추적 및 롤백에 사용  

2. 레코드 추가  
새로운 레코드 추가
해당 레코드는 버퍼풀에 임시로 저장
버퍼풀을 통해서 리두 로그 작성  

3. 커밋
트랜잭션 커밋시 리두 로그에 기록된 변경 사항을 디스크에 적용
리두 로그의 정보를 이용해 버퍼풀의 데이터 페이지를 디스크로 비동기적으로 쓰는 작업 진행  

<br>
